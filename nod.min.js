/* jquery-nod - v1.0.1 - 2013-04-24 
 * https://github.com/casperin/nod 
 * Gorm Casper: Licensed MIT
 */
(function(t){var e,r=function(t,e){return function(){return t.apply(e,arguments)}};e=function(){function t(t,e){this.run=r(this.run,this);var s;s=e[0],this.metric=e[1],this.getVal=this.makeGetVal(t,s)}return t.prototype.run=function(){return this.verify(this.metric,this.getVal())},t.prototype.makeGetVal=function(t,e){var r,s,n;return n=t.attr("type"),"checkbox"===n?function(){return t.is(":checked")}:"radio"===n?(s=t.attr("name"),function(){return jQuery("[name="+s+"]").filter(":checked").val()}):"one-of"===this.metric?(r=jQuery(e),function(){return r.map(function(){return jQuery.trim(this.value)}).get().join("")}):function(){return jQuery.trim(t.val())}},t.prototype.verify=function(t,e){var r,s,n,i;if(t&&t.constructor&&t.call&&t.apply)return t(e);if(t instanceof RegExp)return t.test(e);if(i=jQuery.map(t.split(":"),jQuery.trim),n=i[0],r=i[1],s=i[2],"same-as"===n&&1!==jQuery(r).length)throw Error("same-as selector must target one and only one element");if(!e&&"presence"!==n&&"one-of"!==n)return!0;switch(n){case"presence":return!!e;case"one-of":return!!e;case"exact":return e===r;case"not":return e!==r;case"same-as":return e===jQuery(r).val();case"min-num":return+e>=+r;case"max-num":return+r>=+e;case"between-num":return+e>=+r&&+s>=+e;case"min-length":return e.length>=+r;case"max-length":return+r>=e.length;case"exact-length":return e.length===+r;case"between":return e.length>=+r&&+s>=e.length;case"integer":return/^\s*\d+\s*$/.test(e);case"float":return/^[-+]?[0-9]+(\.[0-9]+)?$/.test(e);case"email":return this.email(e);default:throw Error("I don't know "+n+", sorry.")}},t.prototype.email=function(t){var e;return e=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/,e.test(t)},t}();var s,r=function(t,e){return function(){return t.apply(e,arguments)}};s=function(){function t(t,s,i){this.get=s,this.field=i,this.change_status=r(this.change_status,this),this.runCheck=r(this.runCheck,this),this.delayedCheck=r(this.delayedCheck,this),this.events=r(this.events,this),this.$el=jQuery(t),this.delayId="",this.status=!0,this.checker=new e(this.$el,this.field),this.msg=new n(this.$el,this.get,this.field),this.events()}return t.prototype.events=function(){return"radio"===this.$el.attr("type")?jQuery("[name="+this.$el.attr("name")+"]").on("change",this.runCheck):(this.$el.on("change",this.runCheck),this.$el.on("blur",this.runCheck),"one-of"===this.field[1]&&jQuery(window).on("nod-run-one-of",this.runCheck),this.get.delay?this.$el.on("keyup",this.delayedCheck):void 0)},t.prototype.delayedCheck=function(){return clearTimeout(this.delayId),this.delayId=setTimeout(this.runCheck,this.get.delay)},t.prototype.runCheck=function(){return jQuery.when(this.checker.run()).then(this.change_status)},t.prototype.change_status=function(t){var e;return e=!!t,this.status!==e?(this.status=e,this.msg.toggle(this.status),jQuery(this).trigger("nod_toggle"),"one-of"===this.field[1]&&t?jQuery(window).trigger("nod-run-one-of"):void 0):void 0},t}();var n,r=function(t,e){return function(){return t.apply(e,arguments)}};n=function(){function t(t,e,s){this.$el=t,this.get=e,this.createShowMsg=r(this.createShowMsg,this),this.toggle=r(this.toggle,this),this.createMsg=r(this.createMsg,this),this.$msg=this.createMsg(s[2]),this.showMsg=this.createShowMsg()}return t.prototype.createMsg=function(t){return jQuery("<span/>",{html:t,"class":this.get.helpSpanDisplay+" "+this.get.errorClass})},t.prototype.toggle=function(t){return t?this.$msg.remove():(this.showMsg(),this.get.broadcastError?this.broadcast():void 0)},t.prototype.createShowMsg=function(){var t,e;return e=this.$el.attr("type"),"checkbox"===e||"radio"===e?function(){return this.$el.parent().append(this.$msg)}:(t=this.findPos(this.$el),function(){return t.after(this.$msg)})},t.prototype.findPos=function(t){return this.elHasClass("parent",t)?this.findPos(t.parent()):this.elHasClass("next",t)?this.findPos(t.next()):t},t.prototype.elHasClass=function(t,e){var r,s,n,i;for(i=this.get.errorPosClasses,s=0,n=i.length;n>s;s++)if(r=i[s],e[t](r).length)return!0;return!1},t.prototype.broadcast=function(){return jQuery(window).trigger("nod_error_fired",{el:this.$el,msg:this.$msg.html()})},t}();var i,r=function(t,e){return function(){return t.apply(e,arguments)}};i=function(){function t(t,e,s){this.form=t,this.formIsErrorFree=r(this.formIsErrorFree,this),this.toggleSubmitBtnText=r(this.toggleSubmitBtnText,this),this.toggleSubmitBtn=r(this.toggleSubmitBtn,this),this.toggleGroupClass=r(this.toggleGroupClass,this),this.toggle_status=r(this.toggle_status,this),this.massCheck=r(this.massCheck,this),this.listenForEnter=r(this.listenForEnter,this),this.events=r(this.events,this),this.createListeners=r(this.createListeners,this),e&&(this.get=jQuery.extend({delay:700,disableSubmitBtn:!0,helpSpanDisplay:"help-inline",groupClass:"error",submitBtnSelector:"[type=submit]",metricsSplitter:":",errorPosClasses:[".help-inline",".add-on","button",".input-append"],broadcastError:!1,errorClass:"nod_msg",groupSelector:".control-group"},s),this.listeners=this.createListeners(e),this.submit=this.form.find(this.get.submitBtnSelector),this.checkIfElementsExist(this.form,this.submit,this.get.disableSubmitBtn),this.events())}return t.prototype.createListeners=function(t){var e,r,n,i,o,h,u,a;for(n=[],i=0,h=t.length;h>i;i++)for(r=t[i],3!==r.length&&this["throw"]("field",r),a=this.form.find(r[0]),o=0,u=a.length;u>o;o++)e=a[o],n.push(new s(e,this.get,r));return n},t.prototype.events=function(){var t,e,r,s;for(s=this.listeners,e=0,r=s.length;r>e;e++)t=s[e],jQuery(t).on("nod_toggle",this.toggle_status);return this.submit.length?this.submit.on("click",this.massCheck):this.form.on("keyup",this.listenForEnter)},t.prototype.listenForEnter=function(t){return 13===t.keyCode?this.massCheck():void 0},t.prototype.massCheck=function(t){var e,r,s,n,i,o=this;for(null!=t&&t.preventDefault(),e=[],i=this.listeners,s=0,n=i.length;n>s;s++)r=i[s],e.push(r.runCheck());return this.toggleSubmitBtnText(),jQuery.when.apply(window,e).then(function(){return o.formIsErrorFree()?o.form.submit():void 0}).then(this.toggleSubmitBtnText)},t.prototype.toggle_status=function(t){return this.toggleGroupClass(t.target.$el.parents(this.get.groupSelector)),this.get.disableSubmitBtn?this.toggleSubmitBtn():void 0},t.prototype.toggleGroupClass=function(t){return t.find("."+this.get.errorClass).length?t.addClass(this.get.groupClass):t.removeClass(this.get.groupClass)},t.prototype.toggleSubmitBtn=function(){return this.formIsErrorFree()?this.submit.removeClass("disabled").removeAttr("disabled"):this.submit.addClass("disabled").attr("disabled","disabled")},t.prototype.toggleSubmitBtnText=function(){var t;return t=this.submit.attr("data-loading-text"),t?(this.submit.attr("data-loading-text",this.submit.html()),this.submit.html(t)):void 0},t.prototype.formIsErrorFree=function(){return!jQuery(this.listeners).filter(function(){return!this.status}).length},t.prototype.checkIfElementsExist=function(t,e,r){return t.selector&&t.length||this["throw"]("form",t),!e.length&&r?this["throw"]("submit",e):void 0},t.prototype["throw"]=function(t,e){var r;switch(t){case"form":r="Couldn't find form: ";break;case"submit":r="Couldn't find submit button: ";break;case"field":r="Metrics for each field must have three parts: "}throw Error(r+e)},t}(),t.fn.nod=function(t,e){return new i(this,t,e),this}})(jQuery);