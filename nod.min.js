/* jquery-nod - v1.0.1 - 2013-04-11 
 * https://github.com/casperin/nod 
 * Gorm Casper: Licensed MIT
 */
(function(t){var e,r=function(t,e){return function(){return t.apply(e,arguments)}};e=function(){function t(t,e){this.makeChecker=r(this.makeChecker,this),this.run=r(this.run,this),this.checker=this.makeChecker(t,this.makeValidator(e))}return t.prototype.run=function(){return this.checker()},t.prototype.makeChecker=function(t,e){var r;return r=t.attr("type"),"checkbox"===r?function(){return e(t.is(":checked"))}:"radio"===r?function(){return!t.is(":checked")||t.is(":checked")===e(t.val())}:function(){return e(jQuery.trim(t.val()))}},t.prototype.makeValidator=function(t){var e,r,s,n;if(t&&t.constructor&&t.call&&t.apply)return function(e){return t(e)};if(t instanceof RegExp)return function(e){return t.test(e)};if(n=jQuery.map(t.split(":"),jQuery.trim),s=n[0],e=n[1],r=n[2],"same-as"===s&&1!==jQuery(e).length)throw Error("same-as selector must target one and only one element");switch(s){case"presence":return function(t){return!!t};case"exact":return function(t){return!t||t===e};case"not":return function(t){return!t||t!==e};case"same-as":return function(t){return!t||t===jQuery(e).val()};case"min-num":return function(t){return!t||+t>=+e};case"max-num":return function(t){return!t||+e>=+t};case"between-num":return function(t){return!t||+t>=+e&&+r>=+t};case"min-length":return function(t){return!t||t.length>=+e};case"max-length":return function(t){return!t||+e>=t.length};case"exact-length":return function(t){return!t||t.length===+e};case"between":return function(t){return!t||t.length>=+e&&+r>=t.length};case"integer":return function(t){return!t||/^\s*\d+\s*$/.test(t)};case"float":return function(t){return!t||/^[-+]?[0-9]+(\.[0-9]+)?$/.test(t)};case"email":return function(t){return!t||/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/.test(t)};default:throw Error("I don't know "+s+", sorry.")}},t}();var s,r=function(t,e){return function(){return t.apply(e,arguments)}};s=function(){function t(t,s,i,o){this.get=s,this.change_status=r(this.change_status,this),this.runCheck=r(this.runCheck,this),this.delayedCheck=r(this.delayedCheck,this),this.events=r(this.events,this),this.$el=jQuery(t),this.delayId="",this.status=!0,this.checker=new e(this.$el,i),this.msg=new n(this.$el,this.get,o),this.events()}return t.prototype.events=function(){return"radio"===this.$el.attr("type")?jQuery("[name="+this.$el.attr("name")+"]").on("change",this.runCheck):(this.$el.on("change",this.runCheck),this.$el.on("blur",this.runCheck),this.get.delay?this.$el.on("keyup",this.delayedCheck):void 0)},t.prototype.delayedCheck=function(){return clearTimeout(this.delayId),this.delayId=setTimeout(this.runCheck,this.get.delay)},t.prototype.runCheck=function(){return jQuery.when(this.checker.run()).then(this.change_status)},t.prototype.change_status=function(t){var e;return e=!!t,this.status!==e?(this.status=e,this.msg.toggle(this.status),jQuery(this).trigger("nod_toggle")):void 0},t}();var n,r=function(t,e){return function(){return t.apply(e,arguments)}};n=function(){function t(t,e,s){this.$el=t,this.get=e,this.createShowMsg=r(this.createShowMsg,this),this.toggle=r(this.toggle,this),this.createMsg=r(this.createMsg,this),this.$msg=this.createMsg(s),this.showMsg=this.createShowMsg()}return t.prototype.createMsg=function(t){return jQuery("<span/>",{html:t,"class":this.get.helpSpanDisplay+" "+this.get.errorClass})},t.prototype.toggle=function(t){return t?this.$msg.remove():(this.showMsg(),this.broadcastError?this.broadcast():void 0)},t.prototype.createShowMsg=function(){var t,e;return e=this.$el.attr("type"),"checkbox"===e||"radio"===e?function(){return this.$el.parent().append(this.$msg)}:(t=this.findPos(this.$el),function(){return t.after(this.$msg)})},t.prototype.findPos=function(t){return this.elHasClass("parent",t)?this.findPos(t.parent()):this.elHasClass("next",t)?this.findPos(t.next()):t},t.prototype.elHasClass=function(t,e){var r,s,n,i;for(i=this.get.errorPosClasses,s=0,n=i.length;n>s;s++)if(r=i[s],e[t](r).length)return!0;return!1},t.prototype.broadcast=function(){return jQuery(window).trigger("nod_error_fired",{el:this.$el,msg:this.$msg.html()})},t}();var i,r=function(t,e){return function(){return t.apply(e,arguments)}};i=function(){function t(t,e,s){this.form=t,this.formIsErrorFree=r(this.formIsErrorFree,this),this.toggleSubmitBtn=r(this.toggleSubmitBtn,this),this.toggleGroupClass=r(this.toggleGroupClass,this),this.toggle_status=r(this.toggle_status,this),this.massCheck=r(this.massCheck,this),this.events=r(this.events,this),this.createListeners=r(this.createListeners,this),e&&(this.get=jQuery.extend({delay:700,disableSubmitBtn:!0,helpSpanDisplay:"help-inline",groupClass:"error",submitBtnSelector:"[type=submit]",metricsSplitter:":",errorPosClasses:[".help-inline",".add-on","button",".input-append"],broadcastError:!1,errorClass:"nod_msg",groupSelector:".control-group"},s),this.listeners=this.createListeners(e),this.submit=this.form.find(this.get.submitBtnSelector),this.checkIfElementsExist(this.form,this.submit,this.get.disableSubmitBtn),this.events())}return t.prototype.createListeners=function(t){var e,r,n,i,o,h,u,a,c,l,f;for(n=[],u=0,c=t.length;c>u;u++)for(r=t[u],3!==r.length&&this["throw"]("field",r),h=r[0],i=r[1],o=r[2],f=this.form.find(h),a=0,l=f.length;l>a;a++)e=f[a],n.push(new s(e,this.get,i,o));return n},t.prototype.events=function(){var t,e,r,s;for(s=this.listeners,e=0,r=s.length;r>e;e++)t=s[e],jQuery(t).on("nod_toggle",this.toggle_status);return this.submit.length?this.submit.on("click",this.massCheck):this.form.on("submit",this.massCheck)},t.prototype.massCheck=function(t){var e,r,s,n,i,o=this;for(t.preventDefault(),e=[],i=this.listeners,s=0,n=i.length;n>s;s++)r=i[s],e.push(r.runCheck());return jQuery.when.apply(window,e).then(function(){return o.formIsErrorFree()?o.form.submit():void 0})},t.prototype.toggle_status=function(t){return this.toggleGroupClass(t.target.$el.parents(this.get.groupSelector)),this.get.disableSubmitBtn?this.toggleSubmitBtn():void 0},t.prototype.toggleGroupClass=function(t){return t.find("."+this.get.errorClass).length?t.addClass(this.get.groupClass):t.removeClass(this.get.groupClass)},t.prototype.toggleSubmitBtn=function(){return this.formIsErrorFree()?this.submit.removeClass("disabled").removeAttr("disabled"):this.submit.addClass("disabled").attr("disabled","disabled")},t.prototype.formIsErrorFree=function(){return!jQuery(this.listeners).filter(function(){return!this.status}).length},t.prototype.checkIfElementsExist=function(t,e,r){return t.selector&&t.length||this["throw"]("form",t),!e.length&&r?this["throw"]("submit",e):void 0},t.prototype["throw"]=function(t,e){var r;switch(t){case"form":r="Couldn't find form: ";break;case"submit":r="Couldn't find submit button: ";break;case"field":r="Metrics for each field must have three parts: "}throw Error(r+e)},t}(),t.fn.nod=function(t,e){return new i(this,t,e),this}})(jQuery);